<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Empleados — SistemaCapacita</title>
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800&family=Barlow:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --rojo:#C0392B; --rojo2:#E74C3C;
      --gris:#141414; --gris2:#1e1e1e; --gris3:#2a2a2a; --gris4:#333;
      --blanco:#F0EFEB; --texto:#888;
      --verde:#27AE60; --amarillo:#F39C12;
    }
    body { background:var(--gris); font-family:'Barlow',sans-serif; color:var(--blanco); min-height:100vh; display:flex; }

    /* SIDEBAR igual que dashboard */
    .sidebar { width:240px; min-height:100vh; background:var(--gris2); border-right:1px solid rgba(255,255,255,0.05); display:flex; flex-direction:column; position:fixed; top:0; left:0; z-index:100; }
    .sidebar-logo { padding:28px 24px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; align-items:center; gap:12px; }
    .sidebar-logo .logo-icon { width:36px; height:36px; background:var(--rojo); display:flex; align-items:center; justify-content:center; }
    .sidebar-logo .logo-icon svg { width:20px; height:20px; fill:white; }
    .sidebar-logo .logo-text { font-family:'Barlow Condensed',sans-serif; font-size:16px; font-weight:700; letter-spacing:1px; text-transform:uppercase; line-height:1.2; }
    .sidebar-logo .logo-text span { display:block; font-size:10px; font-weight:400; color:var(--texto); letter-spacing:2px; margin-top:2px; }
    .sidebar-nav { flex:1; padding:20px 0; }
    .nav-section { padding:8px 24px 4px; font-size:10px; font-weight:600; color:var(--texto); letter-spacing:2px; text-transform:uppercase; }
    .nav-item { display:flex; align-items:center; gap:12px; padding:11px 24px; color:var(--texto); text-decoration:none; font-size:14px; font-weight:500; transition:all 0.15s; border-left:3px solid transparent; }
    .nav-item:hover { color:var(--blanco); background:rgba(255,255,255,0.04); }
    .nav-item.active { color:var(--blanco); background:rgba(192,57,43,0.12); border-left-color:var(--rojo); }
    .nav-item svg { width:18px; height:18px; stroke:currentColor; fill:none; stroke-width:1.8; stroke-linecap:round; stroke-linejoin:round; flex-shrink:0; }
    .sidebar-footer { padding:20px 24px; border-top:1px solid rgba(255,255,255,0.05); }
    .user-info { display:flex; align-items:center; gap:12px; margin-bottom:14px; }
    .user-avatar { width:36px; height:36px; background:var(--rojo); display:flex; align-items:center; justify-content:center; font-family:'Barlow Condensed',sans-serif; font-size:16px; font-weight:700; color:white; }
    .user-name { font-size:13px; font-weight:600; }
    .user-role { font-size:11px; color:var(--texto); }
    .btn-logout { display:flex; align-items:center; gap:8px; width:100%; padding:9px 14px; background:rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.07); color:var(--texto); font-family:'Barlow',sans-serif; font-size:13px; cursor:pointer; transition:all 0.15s; text-decoration:none; }
    .btn-logout:hover { background:rgba(192,57,43,0.15); border-color:var(--rojo); color:var(--rojo2); }
    .btn-logout svg { width:15px; height:15px; stroke:currentColor; fill:none; stroke-width:2; stroke-linecap:round; }

    /* MAIN */
    .main { margin-left:240px; flex:1; display:flex; flex-direction:column; }
    .topbar { padding:20px 36px; border-bottom:1px solid rgba(255,255,255,0.05); display:flex; align-items:center; justify-content:space-between; background:var(--gris2); }
    .topbar h1 { font-family:'Barlow Condensed',sans-serif; font-size:26px; font-weight:700; text-transform:uppercase; letter-spacing:1px; }
    .topbar p { font-size:13px; color:var(--texto); margin-top:2px; }

    .btn-primary { display:inline-flex; align-items:center; gap:8px; padding:10px 20px; background:var(--rojo); color:white; font-family:'Barlow Condensed',sans-serif; font-size:14px; font-weight:700; letter-spacing:1px; text-transform:uppercase; text-decoration:none; border:none; cursor:pointer; transition:background 0.15s; }
    .btn-primary:hover { background:var(--rojo2); }
    .btn-primary svg { width:16px; height:16px; stroke:white; fill:none; stroke-width:2.5; stroke-linecap:round; }

    .content { padding:28px 36px; flex:1; }

    /* FILTROS */
    .filters { display:flex; gap:12px; margin-bottom:24px; align-items:center; }
    .search-box { position:relative; flex:1; max-width:340px; }
    .search-box input { width:100%; background:var(--gris2); border:1px solid rgba(255,255,255,0.08); color:var(--blanco); font-family:'Barlow',sans-serif; font-size:14px; padding:10px 14px 10px 40px; outline:none; transition:border-color 0.2s; }
    .search-box input:focus { border-color:var(--rojo); }
    .search-box svg { position:absolute; left:12px; top:50%; transform:translateY(-50%); width:16px; height:16px; stroke:var(--texto); fill:none; stroke-width:2; pointer-events:none; }
    .filter-select { background:var(--gris2); border:1px solid rgba(255,255,255,0.08); color:var(--blanco); font-family:'Barlow',sans-serif; font-size:14px; padding:10px 14px; outline:none; cursor:pointer; }
    .filter-select:focus { border-color:var(--rojo); }
    .btn-filter { padding:10px 18px; background:var(--gris3); border:1px solid rgba(255,255,255,0.08); color:var(--texto); font-family:'Barlow',sans-serif; font-size:13px; cursor:pointer; transition:all 0.15s; }
    .btn-filter:hover { color:var(--blanco); border-color:rgba(255,255,255,0.2); }

    /* GRID EMPLEADOS */
    .empleados-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(260px, 1fr)); gap:16px; }

    .emp-card { background:var(--gris2); border:1px solid rgba(255,255,255,0.05); transition:border-color 0.2s, transform 0.2s; animation:fadeUp 0.4s ease both; }
    .emp-card:hover { border-color:rgba(255,255,255,0.12); transform:translateY(-2px); }

    @keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }

    .emp-card-top { padding:24px; display:flex; align-items:center; gap:16px; border-bottom:1px solid rgba(255,255,255,0.05); }

    .emp-foto { width:56px; height:56px; object-fit:cover; flex-shrink:0; }
    .emp-foto-placeholder { width:56px; height:56px; background:var(--rojo); display:flex; align-items:center; justify-content:center; font-family:'Barlow Condensed',sans-serif; font-size:24px; font-weight:700; color:white; flex-shrink:0; }

    .emp-info { flex:1; min-width:0; }
    .emp-nombre { font-family:'Barlow Condensed',sans-serif; font-size:18px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .emp-legajo { font-size:12px; color:var(--texto); margin-top:3px; letter-spacing:1px; }

    .emp-card-body { padding:16px 24px; }
    .emp-aptitudes { display:flex; flex-wrap:wrap; gap:6px; min-height:28px; }
    .apt-tag { background:rgba(192,57,43,0.12); border:1px solid rgba(192,57,43,0.2); color:var(--rojo2); font-size:11px; font-weight:600; padding:3px 10px; letter-spacing:0.5px; }
    .apt-empty { font-size:12px; color:var(--texto); font-style:italic; }

    .emp-card-footer { padding:12px 24px; border-top:1px solid rgba(255,255,255,0.04); display:flex; gap:8px; }
    .btn-edit { flex:1; padding:8px; background:transparent; border:1px solid rgba(255,255,255,0.1); color:var(--texto); font-family:'Barlow',sans-serif; font-size:12px; cursor:pointer; transition:all 0.15s; text-decoration:none; display:flex; align-items:center; justify-content:center; gap:6px; }
    .btn-edit:hover { color:var(--blanco); border-color:rgba(255,255,255,0.25); }
    .btn-edit svg { width:13px; height:13px; stroke:currentColor; fill:none; stroke-width:2; }
    .btn-delete { padding:8px 12px; background:transparent; border:1px solid rgba(192,57,43,0.2); color:rgba(192,57,43,0.6); font-family:'Barlow',sans-serif; font-size:12px; cursor:pointer; transition:all 0.15s; }
    .btn-delete:hover { background:rgba(192,57,43,0.12); color:var(--rojo2); border-color:var(--rojo); }

    .empty-state { grid-column:1/-1; text-align:center; padding:64px 32px; color:var(--texto); }
    .empty-state svg { width:48px; height:48px; stroke:var(--texto); fill:none; stroke-width:1.2; margin-bottom:16px; display:block; margin-inline:auto; }
    .empty-state h3 { font-family:'Barlow Condensed',sans-serif; font-size:22px; font-weight:700; text-transform:uppercase; margin-bottom:8px; color:var(--gris4); }
  </style>
</head>
<body>

<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-icon"><svg viewBox="0 0 24 24"><path d="M12 2L2 7v10l10 5 10-5V7L12 2zm0 2.18L20 8.5v7L12 19.82 4 15.5v-7L12 4.18z"/></svg></div>
    <div class="logo-text">SistemaCapacita<span>Durlock · La Pampa</span></div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section">Principal</div>
    <a href="/dashboard" class="nav-item"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>Dashboard</a>
    <a href="/empleados" class="nav-item active"><svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>Empleados</a>
    <a href="/aptitudes" class="nav-item"><svg viewBox="0 0 24 24"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>Aptitudes</a>
    <a href="/carnets" class="nav-item"><svg viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>Carnets</a>
    <div class="nav-section" style="margin-top:12px">Visualización</div>
    <a href="/tv" class="nav-item" target="_blank"><svg viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>Vista TV</a>
    <% if (usuario.nivel === 1) { %>
    <div class="nav-section" style="margin-top:12px">Administración</div>
    <a href="/usuarios" class="nav-item"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Usuarios</a>
    <% } %>
  </nav>
  <div class="sidebar-footer">
    <div class="user-info">
      <div class="user-avatar"><%= usuario.nombre.charAt(0).toUpperCase() %></div>
      <div><div class="user-name"><%= usuario.nombre %></div><div class="user-role"><%= usuario.nivel === 1 ? 'Administrador' : 'Supervisor' %></div></div>
    </div>
    <a href="/logout" class="btn-logout"><svg viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>Cerrar sesión</a>
  </div>
</aside>

<main class="main">
  <div class="topbar">
    <div>
      <h1>Empleados</h1>
      <p><%= empleados.length %> empleado<%= empleados.length !== 1 ? 's' : '' %> encontrado<%= empleados.length !== 1 ? 's' : '' %></p>
    </div>
    <% if (usuario.nivel === 1) { %>
    <a href="/empleados/nuevo" class="btn-primary">
      <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      Nuevo Empleado
    </a>
    <% } %>
  </div>

  <div class="content">
    <!-- Filtros -->
    <form method="GET" action="/empleados">
      <div class="filters">
        <div class="search-box">
          <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input type="text" name="busqueda" placeholder="Buscar por nombre o legajo..." value="<%= busqueda %>"/>
        </div>
        <select name="aptitud_id" class="filter-select">
          <option value="">Todas las aptitudes</option>
          <% aptitudes.forEach(a => { %>
          <option value="<%= a.id %>" <%= aptitud_id == a.id ? 'selected' : '' %>><%= a.nombre %></option>
          <% }) %>
        </select>
        <button type="submit" class="btn-filter">Filtrar</button>
        <% if (busqueda || aptitud_id) { %>
        <a href="/empleados" class="btn-filter">Limpiar</a>
        <% } %>
      </div>
    </form>

    <div class="empleados-grid">
      <% if (empleados.length === 0) { %>
        <div class="empty-state">
          <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          <h3>Sin empleados</h3>
          <p>No se encontraron empleados con esos filtros.</p>
        </div>
      <% } %>

      <% empleados.forEach((emp, i) => { %>
        animation-delay: <%= i * 0.05 %>s        <div class="emp-card-top">
          <% if (emp.foto) { %>
            <img src="/uploads/<%= emp.foto %>" alt="<%= emp.nombre %>" class="emp-foto"/>
          <% } else { %>
            <div class="emp-foto-placeholder"><%= emp.nombre.charAt(0) %><%= emp.apellido.charAt(0) %></div>
          <% } %>
          <div class="emp-info">
            <div class="emp-nombre"><%= emp.apellido %>, <%= emp.nombre %></div>
            <div class="emp-legajo">Legajo #<%= emp.legajo %></div>
          </div>
        </div>

        <div class="emp-card-body">
          <div class="emp-aptitudes">
            <% if (emp.aptitudes) { %>
              <% emp.aptitudes.split(', ').forEach(apt => { %>
                <span class="apt-tag"><%= apt %></span>
              <% }) %>
            <% } else { %>
              <span class="apt-empty">Sin aptitudes asignadas</span>
            <% } %>
          </div>
        </div>

        <div class="emp-card-footer">
          <% if (usuario.nivel === 1) { %>
          <a href="/empleados/<%= emp.id %>/editar" class="btn-edit">
            <svg viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            Editar
          </a>
          <form method="POST" action="/empleados/<%= emp.id %>/borrar" onsubmit="return confirm('¿Desactivar a <%= emp.nombre %>?')">
            <button type="submit" class="btn-delete">✕</button>
          </form>
          <% } %>
        </div>
      </div>
      <% }) %>
    </div>
  </div>
</main>

</body>
</html>
